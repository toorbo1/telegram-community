<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Community</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 600px; margin: 0 auto; }
        .card { 
            background: rgba(255, 255, 255, 0.95);
            padding: 25px; 
            margin: 15px 0; 
            border-radius: 20px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        button { 
            background: linear-gradient(135deg, #0088cc 0%, #006699 100%);
            color: white; 
            border: none; 
            padding: 15px 25px; 
            margin: 10px 5px; 
            border-radius: 12px; 
            cursor: pointer; 
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        button.delete { 
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        .hidden { display: none; }
        .post { 
            border: 2px solid #f1f3f4; 
            padding: 20px; 
            margin: 15px 0; 
            border-radius: 15px; 
            background: white;
            transition: all 0.3s ease;
        }
        .post:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .user-info { 
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 20px; 
            border-radius: 15px; 
            margin: 15px 0; 
        }
        .user-avatar { 
            width: 60px; 
            height: 60px; 
            border-radius: 50%; 
            margin-right: 15px;
            border: 3px solid #0088cc;
        }
        .user-details { display: flex; align-items: center; }
        h1 { 
            color: #333; 
            text-align: center; 
            margin-bottom: 20px;
            font-size: 2.2em;
        }
        h2 { color: #0088cc; margin-bottom: 15px; }
        input, textarea { 
            width: 100%; 
            padding: 15px; 
            margin: 10px 0; 
            border: 2px solid #e9ecef; 
            border-radius: 10px; 
            font-size: 16px;
        }
        input:focus, textarea:focus { 
            border-color: #0088cc;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 136, 204, 0.1);
        }
        .admin-badge {
            background: #dc3545;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>ü§ñ Telegram Community</h1>
            <div id="userInfo"></div>
        </div>

        <div id="adminPanel" class="card hidden">
            <h2>‚öôÔ∏è –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
            <input type="text" id="postTitle" placeholder="üìù –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞">
            <textarea id="postContent" placeholder="üìÑ –¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞" rows="4"></textarea>
            <button onclick="createPost()">üì§ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
        </div>

        <div class="card">
            <h2>üì∞ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏</h2>
            <div id="postsContainer">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
    </div>

    <script>
        // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE ===
        // –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–ò –î–ê–ù–ù–´–ï –ù–ê –í–ê–®–ò –° FIREBASE CONSOLE
        const firebaseConfig = {
            apiKey: "your-api-key-here",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "your-app-id"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        const ADMIN_ID = 8036875641;
        let currentUser = null;

        // === –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê ===

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        function initTelegram() {
            if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.expand();
                tg.ready();
                
                console.log('‚úÖ Telegram Web App –ø–æ–¥–∫–ª—é—á–µ–Ω');
                
                // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
                if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    const tgUser = tg.initDataUnsafe.user;
                    currentUser = {
                        id: tgUser.id,
                        first_name: tgUser.first_name,
                        last_name: tgUser.last_name || '',
                        username: tgUser.username || '',
                        photo_url: tgUser.photo_url || '',
                        language_code: tgUser.language_code || 'ru'
                    };
                    
                    console.log('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Telegram:', currentUser);
                    showUserInfo();
                    loadPostsRealtime();
                    
                    // –ï—Å–ª–∏ —ç—Ç–æ –∞–¥–º–∏–Ω - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å
                    if (currentUser.id === ADMIN_ID) {
                        document.getElementById('adminPanel').classList.remove('hidden');
                        console.log('üëë –û–±–Ω–∞—Ä—É–∂–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä');
                    }
                } else {
                    showDemoMode();
                }
            } else {
                showDemoMode();
            }
        }

        // –î–µ–º–æ-—Ä–µ–∂–∏–º –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
        function showDemoMode() {
            console.log('üåê –†–µ–∂–∏–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ (–Ω–µ –≤ Telegram)');
            currentUser = {
                id: Math.floor(Math.random() * 1000000000),
                first_name: '–î–µ–º–æ',
                last_name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                username: 'demo_user'
            };
            showUserInfo();
            loadPostsRealtime();
            
            // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –¥–µ–º–æ-–∞–¥–º–∏–Ω–∞
            const demoBtn = document.createElement('button');
            demoBtn.textContent = 'üëë –î–µ–º–æ: –í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω';
            demoBtn.style.background = 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)';
            demoBtn.onclick = function() {
                currentUser = {
                    id: ADMIN_ID,
                    first_name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                    last_name: '–°–∏—Å—Ç–µ–º—ã',
                    username: 'admin'
                };
                showUserInfo();
                document.getElementById('adminPanel').classList.remove('hidden');
                alert('‚úÖ –†–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!');
            };
            document.querySelector('.card').appendChild(demoBtn);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function showUserInfo() {
            const userInfo = document.getElementById('userInfo');
            userInfo.innerHTML = `
                <div class="user-info">
                    <div class="user-details">
                        ${currentUser.photo_url ? 
                            `<img src="${currentUser.photo_url}" class="user-avatar" alt="Avatar">` : 
                            '<div class="user-avatar" style="background:#0088cc; color:white; display:flex; align-items:center; justify-content:center; font-size:24px;">üë§</div>'
                        }
                        <div>
                            <h3 style="margin:0;">
                                ${currentUser.first_name} ${currentUser.last_name}
                                ${currentUser.id === ADMIN_ID ? '<span class="admin-badge">–ê–î–ú–ò–ù</span>' : ''}
                            </h3>
                            <p style="margin:5px 0; color:#666;">ID: ${currentUser.id}</p>
                            ${currentUser.username ? `<p style="margin:0; color:#666;">@${currentUser.username}</p>` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        function loadPostsRealtime() {
            db.collection("posts")
                .orderBy("createdAt", "desc")
                .limit(20)
                .onSnapshot((snapshot) => {
                    const postsContainer = document.getElementById('postsContainer');
                    const posts = [];
                    
                    snapshot.forEach((doc) => {
                        const post = doc.data();
                        posts.push({
                            id: doc.id,
                            ...post,
                            // –ï—Å–ª–∏ createdAt - —ç—Ç–æ timestamp, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ Date
                            date: post.createdAt ? post.createdAt.toDate() : new Date()
                        });
                    });

                    if (posts.length === 0) {
                        postsContainer.innerHTML = '<div class="post">üìù –ü–æ–∫–∞ –Ω–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</div>';
                        return;
                    }

                    postsContainer.innerHTML = posts.map(post => `
                        <div class="post">
                            <h3 style="color: #0088cc; margin-bottom: 10px;">${post.title}</h3>
                            <p style="line-height: 1.6; margin-bottom: 10px;">${post.content}</p>
                            <small style="color: #666;">
                                üìÖ ${post.date.toLocaleDateString('ru-RU')} 
                                üïí ${post.date.toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'})}
                                ${post.authorName ? `<br>üë§ –ê–≤—Ç–æ—Ä: ${post.authorName}` : ''}
                            </small>
                            ${currentUser && currentUser.id === ADMIN_ID ? 
                                `<br><button onclick="deletePost('${post.id}')" class="delete">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>` : ''}
                        </div>
                    `).join('');
                }, (error) => {
                    console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–æ–≤:", error);
                    document.getElementById('postsContainer').innerHTML = 
                        '<div class="post" style="color: #dc3545;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.</div>';
                });
        }

        // –°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç
        async function createPost() {
            if (!currentUser || currentUser.id !== ADMIN_ID) {
                alert('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç—ã');
                return;
            }

            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('postContent').value.trim();

            if (!title || !content) {
                alert('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            try {
                await db.collection("posts").add({
                    title: title,
                    content: content,
                    authorId: currentUser.id,
                    authorName: currentUser.first_name + ' ' + currentUser.last_name,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
                document.getElementById('postTitle').value = '';
                document.getElementById('postContent').value = '';
                
                alert('‚úÖ –ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω! –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–≤–∏–¥—è—Ç –µ–≥–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.');
                
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞:", error);
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ—Å—Ç–∞: ' + error.message);
            }
        }

        // –£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç
        async function deletePost(postId) {
            if (!currentUser || currentUser.id !== ADMIN_ID) return;
            
            if (!confirm('‚ùì –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç?')) return;
            
            try {
                await db.collection("posts").doc(postId).delete();
                alert('‚úÖ –ü–æ—Å—Ç —É–¥–∞–ª–µ–Ω!');
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞:", error);
                alert('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞');
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', initTelegram);

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        window.createPost = createPost;
        window.deletePost = deletePost;
    </script>
</body>
</html>